{% extends "base.html" %}
{% block content %}
  <a class="btn btn-link mb-3" href="{{ url_for('list_tweets') }}">&larr; Powrót</a>

  <div class="card p-4 mb-4">
    <div class="d-flex justify-content-between align-items-start">
      <h4 class="mb-2">Tweet</h4>
      <span class="muted">{{ created_display }}</span>
    </div>
    <p class="fs-5 mb-0">{{ tweet.text }}</p>
    <div class="mt-2 d-flex gap-2">
      {% if tweet.isReply %}<span class="pill">reply</span>{% endif %}
      {% if tweet.isRetweet %}<span class="pill">retweet</span>{% endif %}
      {% if tweet.isQuote %}<span class="pill">quote</span>{% endif %}
    </div>
  </div>

  <div class="card p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Notowania od minuty publikacji (15 min)</h5>
    </div>
    <div id="chart" style="height:420px;"></div>
    <small class="muted">OHLC minutowe • okno 15 min od publikacji</small>
  </div>

  <div class="card p-3 mt-3">
    <h6 class="mb-2">Lista minut (tekst)</h6>
    <pre id="minute-list" class="mb-0" style="white-space:pre-wrap;"></pre>
  </div>

  <script>
    // KLUCZOWE: muszą być podwójne klamry!
    window.APP_CONFIG = { startUnix: {{ created_ts }}, minutes: 15 };
    document.addEventListener('DOMContentLoaded', () => {
      renderChartFromConfig();
      fetch(`/api/price?start=${window.APP_CONFIG.startUnix}&minutes=${window.APP_CONFIG.minutes}&format=text`)
        .then(r => r.text())
        .then(t => { document.getElementById('minute-list').textContent = t; })
        .catch(() => { document.getElementById('minute-list').textContent = 'Błąd ładowania listy minut.'; });
    });
  </script>
{% endblock %}
